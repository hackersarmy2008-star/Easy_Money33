<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Investments</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
  <div class="header-top">
    <div class="logo">My Investments</div>
    <div class="icons">
      <i class="bi bi-house-door" onclick="window.location.href='index.html'"></i>
    </div>
  </div>

  <main>
    <div class="banner">
      <div class="card" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color: white; padding: 24px; border-radius: 16px; margin-bottom: 24px;">
        <h2 style="margin: 0 0 16px 0; font-size: 20px;">Investment Summary</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
          <div>
            <div style="font-size: 12px; opacity: 0.9;">Active</div>
            <div id="activeCount" style="font-size: 24px; font-weight: 700;">0</div>
          </div>
          <div>
            <div style="font-size: 12px; opacity: 0.9;">Invested</div>
            <div id="totalInvested" style="font-size: 24px; font-weight: 700;">₹0</div>
          </div>
          <div>
            <div style="font-size: 12px; opacity: 0.9;">Earned</div>
            <div id="totalEarned" style="font-size: 24px; font-weight: 700;">₹0</div>
          </div>
        </div>
      </div>

      <h3 style="margin: 24px 0 16px 0; font-size: 18px; font-weight: 700;">My Investment History</h3>
      <div id="investmentsList">
        <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
          <i class="bi bi-graph-up" style="font-size: 48px; opacity: 0.3;"></i>
          <p style="margin-top: 16px;">Loading investments...</p>
        </div>
      </div>
    </div>
  </main>

  <div class="bottom-nav">
    <a href="index.html" class="nav-item">
      <i class="bi bi-house-door"></i>
      Home
    </a>
    <a href="products.html" class="nav-item">
      <i class="bi bi-grid"></i>
      Products
    </a>
    <a href="promotion.html" class="nav-item">
      <i class="bi bi-people"></i>
      Promotion
    </a>
    <a href="mine.html" class="nav-item">
      <i class="bi bi-person"></i>
      Mine
    </a>
  </div>

  <script src="main.js"></script>
  <script>
    async function loadInvestments() {
      try {
        const data = await apiCall('/investments', 'GET');
        
        document.getElementById('activeCount').textContent = data.summary.activeInvestments;
        document.getElementById('totalInvested').textContent = '₹' + data.summary.totalInvested;
        document.getElementById('totalEarned').textContent = '₹' + data.summary.totalEarned;

        const listDiv = document.getElementById('investmentsList');
        
        if (!data.investments || data.investments.length === 0) {
          listDiv.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
              <i class="bi bi-inbox" style="font-size: 48px; opacity: 0.3;"></i>
              <p style="margin-top: 16px;">No investments yet</p>
              <p style="font-size: 14px;">Start investing to earn ₹100 daily</p>
            </div>
          `;
          return;
        }

        listDiv.innerHTML = data.investments.map(inv => {
          const created = new Date(inv.created_at);
          const lastGrowth = inv.last_growth_time ? new Date(inv.last_growth_time) : null;
          const nextGrowth = lastGrowth ? new Date(lastGrowth.getTime() + 24 * 60 * 60 * 1000) : null;
          const timeUntilNext = nextGrowth ? Math.max(0, Math.floor((nextGrowth - new Date()) / 1000 / 60 / 60)) : 0;
          
          return `
            <div class="card" style="padding: 20px; margin-bottom: 16px; border: 2px solid ${inv.status === 'active' ? 'var(--primary)' : '#e5e7eb'};">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                <div>
                  <h4 style="margin: 0 0 4px 0; font-size: 16px; font-weight: 700;">${inv.plan_name}</h4>
                  <p style="margin: 0; font-size: 12px; color: var(--muted);">
                    Started ${created.toLocaleDateString()}
                  </p>
                </div>
                <span style="padding: 4px 12px; background: ${inv.status === 'active' ? 'var(--success)' : '#6b7280'}; color: white; border-radius: 12px; font-size: 12px; font-weight: 600;">
                  ${inv.status.toUpperCase()}
                </span>
              </div>
              
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px;">
                  <div style="font-size: 11px; color: var(--muted); margin-bottom: 4px;">Investment</div>
                  <div style="font-size: 16px; font-weight: 700;">₹${inv.amount}</div>
                </div>
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px;">
                  <div style="font-size: 11px; color: var(--muted); margin-bottom: 4px;">Total Earned</div>
                  <div style="font-size: 16px; font-weight: 700; color: var(--success);">₹${inv.total_profit}</div>
                </div>
              </div>

              <div style="background: linear-gradient(135deg, var(--primary-3) 0%, var(--primary-2) 100%); padding: 12px; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-size: 11px; color: #6b5200; margin-bottom: 4px;">Daily Growth</div>
                    <div style="font-size: 18px; font-weight: 700; color: #6b5200;">₹${inv.daily_profit}</div>
                  </div>
                  ${inv.status === 'active' && nextGrowth ? `
                    <div style="text-align: right;">
                      <div style="font-size: 11px; color: #6b5200; margin-bottom: 4px;">Next in</div>
                      <div style="font-size: 14px; font-weight: 700; color: #6b5200;">${timeUntilNext}h</div>
                    </div>
                  ` : ''}
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Load investments error:', error);
        document.getElementById('investmentsList').innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: var(--danger);">
            <i class="bi bi-exclamation-circle" style="font-size: 48px;"></i>
            <p style="margin-top: 16px;">Failed to load investments</p>
          </div>
        `;
      }
    }

    loadInvestments();
  </script>
</body>
</html>
